# /etc/modprobe.d/disable-modules.conf
# {{ ansible_managed }}
# Security hardening configuration - DO NOT EDIT MANUALLY
# Generated by SummitEthic Ansible on {{ ansible_date_time.date }}
#
# This configuration blacklists kernel modules that may pose security risks
# or aren't typically needed for server operations.
# 
# References:
#  - CIS Benchmark for Distribution-Independent Linux
#  - DISA STIG for RHEL/Debian
#  - NSA Security Configuration Guidance

#######################
# Uncommon Filesystems
#######################
# These filesystems are rarely needed in production environments
# and may contain known vulnerabilities

# cramfs - Compressed ROM/RAM filesystem with known vulnerabilities
blacklist cramfs
install cramfs /bin/false

# freevxfs - SCO UnixWare filesystem, not commonly used
blacklist freevxfs
install freevxfs /bin/false

# jffs2 - Journaling Flash File System, typically only needed for embedded devices
blacklist jffs2
install jffs2 /bin/false

# hfs/hfsplus - Hierarchical File System (Apple)
blacklist hfs
install hfs /bin/false
blacklist hfsplus
install hfsplus /bin/false

# squashfs - Compressed read-only filesystem (acceptable if explicitly needed)
{% if security_blacklist_squashfs | default(true) %}
blacklist squashfs
install squashfs /bin/false
{% else %}
# squashfs explicitly allowed by configuration
{% endif %}

# udf - Universal Disk Format filesystem
blacklist udf
install udf /bin/false

##########################
# Networking Protocols
##########################
# These protocols may introduce security risks and are rarely needed
# in standard server environments

# DCCP - Datagram Congestion Control Protocol, susceptible to resource exhaustion attacks
blacklist dccp
install dccp /bin/false

# SCTP - Stream Control Transmission Protocol, may have unnecessary attack surface
blacklist sctp
install sctp /bin/false

# RDS - Reliable Datagram Sockets, multiple CVEs in the past
blacklist rds
install rds /bin/false

# TIPC - Transparent Inter Process Communication, rarely needed
blacklist tipc
install tipc /bin/false

##########################
# Storage Protocols
##########################
# Disable unless explicitly required

# USB Storage (uncomment if not needed)
{% if security_blacklist_usb_storage | default(false) %}
blacklist usb-storage
install usb-storage /bin/false
{% else %}
# USB storage explicitly allowed by configuration
{% endif %}

# FireWire storage - Potential DMA attacks
blacklist firewire-ohci
install firewire-ohci /bin/false
blacklist firewire-core
install firewire-core /bin/false
blacklist firewire-sbp2
install firewire-sbp2 /bin/false

##########################
# Miscellaneous Protocols
##########################

# Appletalk - Legacy Apple protocol, rarely needed
blacklist appletalk
install appletalk /bin/false

# IPX - Internetwork Packet Exchange, legacy Novell protocol
blacklist ipx
install ipx /bin/false

# Bluetooth - Disable if not needed
{% if security_blacklist_bluetooth | default(false) %}
blacklist bluetooth
install bluetooth /bin/false
blacklist btusb
install btusb /bin/false
{% else %}
# Bluetooth explicitly allowed by configuration
{% endif %}

##########################
# Hardware Protocols
##########################

# Thunderbolt - Potential DMA attacks
{% if security_blacklist_thunderbolt | default(true) %}
blacklist thunderbolt
install thunderbolt /bin/false
{% else %}
# Thunderbolt explicitly allowed by configuration
{% endif %}

# PCMCIA/CardBus - Legacy hardware support
{% if security_blacklist_pcmcia | default(true) %}
blacklist pcmcia
install pcmcia /bin/false
blacklist pcmcia_core
install pcmcia_core /bin/false
{% else %}
# PCMCIA explicitly allowed by configuration
{% endif %}

##########################
# Additional Security Measures
##########################

# Disable loading of new kernel modules by non-root users
{% if security_restrict_kmod_loading | default(true) %}
# This will be configured separately in sysctl configuration
# kernel.modules_disabled = 1
{% endif %}

# End of configuration