#!/bin/bash
# Remote backup sync script - Generated by Ansible

set -e

echo "Starting remote backup sync at $(date)"

# Configuration
BACKUP_DIR="{{ backup_base_dir }}"
REMOTE_TYPE="{{ backup_remote_type }}"

{% if backup_remote_type == 's3' %}
# S3 sync
echo "Syncing backups to S3..."
"${BACKUP_DIR}/scripts/s3_sync.sh"
{% elif backup_remote_type == 'rsync' %}
# Rsync sync
echo "Syncing backups using rsync..."
rsync -avz --delete \
  -e "ssh -i {{ backup_rsync_key }}" \
  "${BACKUP_DIR}/" \
  "{{ backup_rsync_user }}@{{ backup_rsync_host }}:{{ backup_rsync_path }}/"
{% elif backup_remote_type == 'rclone' %}
# Rclone sync
echo "Syncing backups using rclone..."
rclone sync "${BACKUP_DIR}/" "remote:{{ backup_rclone_path }}" \
  --progress --stats 30s
{% endif %}

echo "Remote backup sync completed at $(date)"